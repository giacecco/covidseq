// Data from RIVM at https://data.rivm.nl/covid-19/COVID-19_aantallen_gemeente_cumulatief.csv
// Last updated: Sat Feb 06 2021 10:00:00 GMT+0100 (Central European Standard Time)
const CONFIGURATION = {"octaves":3,"municipalitiesByNote":[[{"m":"Terschelling","d":1},{"m":"Rozendaal","d":1},{"m":"Zoeterwoude","d":1},{"m":"Noord-Beveland","d":1},{"m":"Appingedam","d":2},{"m":"Harlingen","d":2},{"m":"Eemnes","d":2},{"m":"Beemster","d":2},{"m":"Veere","d":2},{"m":"Opmeer","d":3},{"m":"Ouder-Amstel","d":3},{"m":"Texel","d":3},{"m":"Opsterland","d":4},{"m":"Baarle-Nassau","d":4},{"m":"Ooststellingwerf","d":5},{"m":"Renswoude","d":5},{"m":"Blaricum","d":5},{"m":"Landsmeer","d":5},{"m":"Borsele","d":5},{"m":"Kapelle","d":5},{"m":"Alphen-Chaam","d":5},{"m":"Hattem","d":6},{"m":"Oostzaan","d":6},{"m":"Simpelveld","d":6},{"m":"Delfzijl","d":7},{"m":"Montfoort","d":7},{"m":"Woudenberg","d":7},{"m":"Langedijk","d":7},{"m":"Uitgeest","d":7},{"m":"Reimerswaal","d":7},{"m":"Reusel-De Mierden","d":7},{"m":"Bergeijk","d":7},{"m":"Westervoort","d":8},{"m":"Vlissingen","d":8},{"m":"Pekela","d":8},{"m":"Mill en Sint Hubert","d":8},{"m":"Stadskanaal","d":9},{"m":"Veendam","d":9},{"m":"Doesburg","d":9},{"m":"Lopik","d":9},{"m":"Brielle","d":9},{"m":"Olst-Wijhe","d":9},{"m":"Kaag en Braassem","d":9},{"m":"Duiven","d":10},{"m":"Wijk bij Duurstede","d":10},{"m":"Enkhuizen","d":10},{"m":"Waalre","d":10},{"m":"Beesel","d":10},{"m":"Bergen (L.)","d":10},{"m":"Voerendaal","d":10},{"m":"Teylingen","d":10},{"m":"Aa en Hunze","d":10},{"m":"Eemsdelta","d":10},{"m":"Assen","d":11},{"m":"Bunnik","d":11},{"m":"Bloemendaal","d":11},{"m":"Heiloo","d":11},{"m":"Uithoorn","d":11},{"m":"Drechterland","d":11},{"m":"Hulst","d":11},{"m":"Someren","d":11},{"m":"Mook en Middelaar","d":11},{"m":"Wijdemeren","d":11},{"m":"Westerveld","d":11},{"m":"Sint Anthonis","d":11}],[{"m":"Zeewolde","d":12},{"m":"Urk","d":12},{"m":"Scherpenzeel","d":12},{"m":"Edam-Volendam","d":12},{"m":"Rucphen","d":12},{"m":"Beek","d":12},{"m":"Borger-Odoorn","d":12},{"m":"Dantumadiel","d":12},{"m":"Weststellingwerf","d":13},{"m":"Elburg","d":13},{"m":"Putten","d":13},{"m":"Winterswijk","d":13},{"m":"Oudewater","d":13},{"m":"Waddinxveen","d":13},{"m":"Tytsjerksteradiel","d":13},{"m":"Haaren","d":13},{"m":"Vaals","d":13},{"m":"Heeze-Leende","d":13},{"m":"Midden-Delfland","d":13},{"m":"Stede Broec","d":14},{"m":"Hillegom","d":14},{"m":"Westvoorne","d":14},{"m":"Waterland","d":14},{"m":"Wormerland","d":14},{"m":"Valkenburg aan de Geul","d":14},{"m":"Bronckhorst","d":14},{"m":"Westerkwartier","d":14}],[{"m":"Ommen","d":15},{"m":"Brummen","d":15},{"m":"Buren","d":15},{"m":"Den Helder","d":15},{"m":"West Maas en Waal","d":15},{"m":"Asten","d":15},{"m":"Steenbergen","d":15},{"m":"Westerwolde","d":15},{"m":"Tubbergen","d":16},{"m":"Heumen","d":16},{"m":"Hardinxveld-Giessendam","d":16},{"m":"Nuenen, Gerwen en Nederwetten","d":16},{"m":"Gennep","d":16},{"m":"Nederweert","d":16},{"m":"Hollands Kroon","d":16},{"m":"Achtkarspelen","d":17},{"m":"Beuningen","d":17},{"m":"Culemborg","d":17},{"m":"Rhenen","d":17},{"m":"Castricum","d":17},{"m":"Medemblik","d":17},{"m":"Lisse","d":17},{"m":"Noordwijk","d":17},{"m":"Middelburg","d":17},{"m":"Zundert","d":17},{"m":"Steenwijkerland","d":17}],[{"m":"Dalfsen","d":18},{"m":"Staphorst","d":18},{"m":"Aalten","d":18},{"m":"Weesp","d":18},{"m":"Alblasserdam","d":18},{"m":"Goes","d":18},{"m":"Koggenland","d":18},{"m":"De Wolden","d":18},{"m":"Sluis","d":18},{"m":"Gulpen-Wittem","d":18},{"m":"Montferland","d":18},{"m":"Beverwijk","d":19},{"m":"Nieuwkoop","d":19},{"m":"Albrandswaard","d":19},{"m":"Gilze en Rijen","d":19},{"m":"Maasgouw","d":19},{"m":"Leusden","d":20},{"m":"Voorschoten","d":20},{"m":"Hilvarenbeek","d":20},{"m":"Stein","d":20},{"m":"Cuijk","d":20},{"m":"Noordenveld","d":20},{"m":"Tynaarlo","d":20},{"m":"Het Hogeland","d":20}],[{"m":"Leiderdorp","d":21},{"m":"Eersel","d":21},{"m":"Oisterwijk","d":21},{"m":"Schouwen-Duiveland","d":21},{"m":"Coevorden","d":22},{"m":"Dronten","d":22},{"m":"Nieuwegein","d":22},{"m":"Aalsmeer","d":22},{"m":"Tholen","d":22},{"m":"Meerssen","d":22},{"m":"Halderberge","d":22},{"m":"Landerd","d":22},{"m":"Hof van Twente","d":22},{"m":"Geldrop-Mierlo","d":22},{"m":"De Fryske Marren","d":22}],[{"m":"Meppel","d":23},{"m":"Wierden","d":23},{"m":"Renkum","d":23},{"m":"Zutphen","d":23},{"m":"Baarn","d":23},{"m":"Heerhugowaard","d":23},{"m":"Boekel","d":23},{"m":"Dongen","d":23},{"m":"Geertruidenberg","d":23},{"m":"Oirschot","d":23},{"m":"Woensdrecht","d":23},{"m":"Roerdalen","d":23},{"m":"Bladel","d":23},{"m":"Midden-Drenthe","d":23},{"m":"Smallingerland","d":24},{"m":"Druten","d":24},{"m":"Nijkerk","d":24},{"m":"Heemskerk","d":24},{"m":"Terneuzen","d":24},{"m":"Grave","d":24},{"m":"Lingewaard","d":24},{"m":"Drimmelen","d":24},{"m":"Noardeast-Fryslân","d":24},{"m":"Molenlanden","d":24}],[{"m":"Groningen","d":25},{"m":"Laren","d":25},{"m":"Hendrik-Ido-Ambacht","d":25},{"m":"Oldambt","d":25},{"m":"Zwartewaterland","d":25},{"m":"Noordoostpolder","d":26},{"m":"Doetinchem","d":26},{"m":"Lochem","d":26},{"m":"Maasdriel","d":26},{"m":"Voorst","d":26},{"m":"Best","d":26},{"m":"Son en Breugel","d":26},{"m":"Overbetuwe","d":26}],[{"m":"Twenterand","d":27},{"m":"Midden-Groningen","d":27},{"m":"Heerenveen","d":28},{"m":"Wassenaar","d":28},{"m":"Sint-Michielsgestel","d":28},{"m":"Echt-Susteren","d":28},{"m":"Gooise Meren","d":28},{"m":"Losser","d":29},{"m":"Oldebroek","d":29},{"m":"Bergen (NH.)","d":29},{"m":"Diemen","d":29},{"m":"Maassluis","d":29},{"m":"Oegstgeest","d":29},{"m":"Woerden","d":29},{"m":"Neder-Betuwe","d":29},{"m":"Pijnacker-Nootdorp","d":29}],[{"m":"Haaksbergen","d":30},{"m":"Heerde","d":30},{"m":"Nunspeet","d":30},{"m":"Gorinchem","d":30},{"m":"Moerdijk","d":30},{"m":"Waadhoeke","d":30},{"m":"Ermelo","d":31},{"m":"Dinkelland","d":31},{"m":"Bodegraven-Reeuwijk","d":31}],[{"m":"De Ronde Venen","d":32},{"m":"Oosterhout","d":32},{"m":"Borne","d":33},{"m":"Raalte","d":33},{"m":"Papendrecht","d":33},{"m":"Goirle","d":33},{"m":"Loon op Zand","d":33},{"m":"Laarbeek","d":33},{"m":"Schagen","d":34},{"m":"Sliedrecht","d":34},{"m":"Etten-Leur","d":34}],[{"m":"Hoogeveen","d":35},{"m":"Wageningen","d":35},{"m":"Hellevoetsluis","d":35},{"m":"Bergen op Zoom","d":35},{"m":"Hardenberg","d":36},{"m":"Zaltbommel","d":36},{"m":"Oost Gelre","d":36},{"m":"Gemert-Bakel","d":36},{"m":"Eijsden-Margraten","d":36},{"m":"Zevenaar","d":37},{"m":"Deurne","d":37},{"m":"Brunssum","d":37}],[{"m":"Epe","d":38},{"m":"Bunschoten","d":38},{"m":"Barendrecht","d":38},{"m":"Roermond","d":38},{"m":"Leeuwarden","d":39},{"m":"Harderwijk","d":39},{"m":"Veldhoven","d":39},{"m":"Oude IJsselstreek","d":39},{"m":"Berkelland","d":39},{"m":"Beekdaelen","d":39}],[{"m":"Oldenzaal","d":40},{"m":"Boxmeer","d":40},{"m":"Venray","d":40},{"m":"Zuidplas","d":40},{"m":"Kampen","d":41},{"m":"Hoorn","d":41},{"m":"Zandvoort","d":41},{"m":"Berg en Dal","d":42},{"m":"Soest","d":43},{"m":"Katwijk","d":43},{"m":"West Betuwe","d":43}],[{"m":"Hellendoorn","d":44},{"m":"Heusden","d":44},{"m":"Leudal","d":44},{"m":"Rijssen-Holten","d":45},{"m":"Hengelo","d":46},{"m":"Zeist","d":47},{"m":"Valkenswaard","d":47},{"m":"Cranendonck","d":47}],[{"m":"Almelo","d":48},{"m":"Rheden","d":48},{"m":"IJsselstein","d":48},{"m":"Landgraaf","d":48},{"m":"Hoeksche Waard","d":48},{"m":"Barneveld","d":50},{"m":"Wijchen","d":50},{"m":"Houten","d":50},{"m":"Vught","d":50},{"m":"Utrechtse Heuvelrug","d":50}],[{"m":"Emmen","d":51},{"m":"Huizen","d":51},{"m":"Leiden","d":53},{"m":"Zoetermeer","d":53},{"m":"Heemstede","d":55}],[{"m":"Lelystad","d":56},{"m":"Tiel","d":57},{"m":"Alkmaar","d":57},{"m":"Horst aan de Maas","d":58},{"m":"Lansingerland","d":58},{"m":"Stichtse Vecht","d":58},{"m":"Vijfheerenlanden","d":58}],[{"m":"Krimpenerwaard","d":59},{"m":"Krimpen aan den IJssel","d":61},{"m":"Boxtel","d":61},{"m":"Roosendaal","d":61},{"m":"Súdwest-Fryslân","d":61},{"m":"Purmerend","d":62},{"m":"Goeree-Overflakkee","d":63},{"m":"Hengelo (O.)","d":63}],[{"m":"De Bilt","d":64},{"m":"Ede","d":65},{"m":"Ridderkerk","d":65},{"m":"Altena","d":65},{"m":"Delft","d":66},{"m":"Weert","d":66}],[{"m":"Veenendaal","d":67},{"m":"Almere","d":69},{"m":"Rijswijk","d":70},{"m":"Helmond","d":70},{"m":"Peel en Maas","d":71}],[{"m":"Hilversum","d":72},{"m":"Zwijndrecht","d":72},{"m":"Leidschendam-Voorburg","d":72},{"m":"Bernheze","d":73},{"m":"Velsen","d":74},{"m":"Waalwijk","d":74}],[{"m":"Uden","d":76},{"m":"Deventer","d":78},{"m":"Vlaardingen","d":79},{"m":"Westland","d":80},{"m":"Zwolle","d":81}],[{"m":"Nissewaard","d":82},{"m":"Kerkrade","d":83},{"m":"Amstelveen","d":84},{"m":"Schiedam","d":92}],[{"m":"Alphen aan den Rijn","d":94},{"m":"Haarlemmermeer","d":95},{"m":"Amersfoort","d":100},{"m":"Arnhem","d":106}],[{"m":"Sittard-Geleen","d":109},{"m":"Heerlen","d":110},{"m":"Capelle aan den IJssel","d":111},{"m":"Oss","d":115}],[{"m":"Venlo","d":124},{"m":"Dordrecht","d":131},{"m":"Breda","d":135}],[{"m":"Haarlem","d":137},{"m":"Apeldoorn","d":138},{"m":"Gouda","d":138}],[{"m":"'s-Hertogenbosch","d":142},{"m":"Zaanstad","d":148},{"m":"Enschede","d":153}],[{"m":"Meierijstad","d":160},{"m":"Nijmegen","d":167}],[{"m":"Maastricht","d":176},{"m":"Utrecht","d":208}],[{"m":"Eindhoven","d":256},{"m":"Tilburg","d":269}],[{"m":"'s-Gravenhage","d":487}],[{"m":"Amsterdam","d":632}],[{"m":"Rotterdam","d":759}],[{"m":"Rotterdam","d":759}],[{"m":"Rotterdam","d":759}]]}

config.bufferSize = 1

// from https://stackoverflow.com/a/12646864/1218376
function shuffleArray(array) {
    for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
    }
}
let sequence = [...Array(CONFIGURATION.octaves * 12).keys()]
shuffleArray(sequence)
let sequencePosition = 0
let wasLow = true

function process(block) {

  if(wasLow && (block.switches[0] || block.inputs[0][0])) {
      wasLow = false
      if (++sequencePosition === sequence.length) sequencePosition = 0
      let municipality = CONFIGURATION.municipalitiesByNote[sequencePosition][Math.floor(Math.random() * CONFIGURATION.municipalitiesByNote[sequencePosition].length)]
      display(municipality.m + ": " + municipality.d + " doden")
      block.outputs[0][0] = 0 - CONFIGURATION.octaves / 2. + sequence[sequencePosition] / CONFIGURATION.octaves / 12
  }
  wasLow = !block.switches[0] && !block.inputs[0][0]

}
